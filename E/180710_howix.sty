  \usepackage[utf8]{inputenc}
  \renewcommand{\encodingdefault}{T1}

  \usepackage{bophook}
  \usepackage[x-1a]{pdfx} % ALSO LOADED BY ../lib/mdsh/book-A5.functions
 %\usepackage[hidelinks]{hyperref}
 % https://tex.stackexchange.com/questions/89013/
 % -> pdfx-package-gives-me-option-clash-for-package-hyperref
  \hypersetup{hidelinks}

  \usepackage{scalefnt}
  \usepackage{setspace}
  \usepackage{sectsty}
  \usepackage[activate={true,nocompatibility},
              final,tracking=true,kerning=true,
              spacing=true,factor=1100,
              stretch=10,shrink=10]{microtype}
  \usepackage[defaultlines=5,all]{nowidow}
  \usepackage{textcomp}
  \usepackage{pifont}
  \usepackage{eurosym} % https://tex.stackexchange.com/a/109267
  \let\texteuro\euro
  \usepackage{xcolor}
  \usepackage{eso-pic}
  \usepackage{pdfpages}
  \usepackage{ragged2e} % \justifying
  \usepackage{fancyhdr}
  \usepackage{everypage}
  \usepackage{needspace}
  \usepackage{textcomp}
  \usepackage{afterpage}
  \usepackage{etoolbox}

% --------------------------------------------------------------------------- %
%  F O R M A T 
% --------------------------------------------------------------------------- %

  \setlength\topmargin{-.09\paperheight}
  \setlength\oddsidemargin{.09\paperwidth}
  \setlength\evensidemargin{-.04\paperwidth}
  \setlength\textheight{.76\paperheight}
  \setlength\textwidth{.62\paperwidth}

  \setlength\marginparwidth{2.5cm}
  \setlength\marginparsep{4pt} % 6pt


% --------------------------------------------------------------------------- %
%  F U N C T I O N A L 
% --------------------------------------------------------------------------- %

  % PREVENT HYPHENATION FOR WORDS STARTING WITH UPPERCASE
  \uchyph=0
  % PREVENT HYPHENATION OVER PAGE BREAK
  \brokenpenalty10000\relax

 %\newcommand{\setwidowstandard}{\setnowidow[5]\setnoclub[5]}
 %\setwidowstandard

  % https://groups.google.com/forum/#!topic/pandoc-discuss/O-N0H1eBnVU
  \let\oldhref=\href 
  \renewcommand{\href}[2]{#2\footnote{#1}}


  \DeclareUnicodeCharacter{00A0}{\,}

% --------------------------------------------------------------------------- %
%  F O N T S
% --------------------------------------------------------------------------- %
  \newcommand{\ttstandard}{grm}
  \newcommand{\rmstandard}{pju}
 %\newcommand{\sfstandard}{phv}
  \newcommand{\sfstandard}{pju}

  \renewcommand*{\ttdefault}{\ttstandard}\selectfont
  \renewcommand*{\rmdefault}{\rmstandard}\selectfont
  \renewcommand*{\sfdefault}{\sfstandard}\selectfont

  \newcommand{\embody}{}
 % CHANGE \emph FOR BODYTEXT
   \DeclareTextFontCommand{\emph}{%
     \ifbodytext%
     \embody
     \else\em %
     \fi%
  }

 % TTNEU
  \let\OldTexttt\texttt
  \renewcommand{\texttt}[1]{%
  \OldTexttt{\fontfamily{\ttstandard}%
              \selectfont{%
              %\relscale{1.05}{#1}}}}
               \relscale{.95}{#1}}}}

  \newcommand\http[1]{{\scalefont{.8}\seqsplit{\tt ##1}}}
  
% --------------------------------------------------------------------------- %
%  W H I T E S P A C E
% --------------------------------------------------------------------------- %
  \parindent=0pt
  \setlength{\parskip}{5pt plus 5pt minus 5pt}
  \setstretch{1.1} % LINEHEIGHT % (P:setspace)

% --------------------------------------------------------------------------- %
%  H E A D L I N E S
% --------------------------------------------------------------------------- %
  % REMOVE NUMBERING
  % https://tex.stackexchange.com/questions/80113/
  % -> hide-section-numbers-but-keep-numbering
  \renewcommand*{\chapterformat}{}
  \let\CHAPTER\chapter
  \renewcommand\chapter[1]{\CHAPTER{#1}}
  \let\SECTION\section
  \renewcommand\section[1]{\SECTION*{#1}}
  \let\SUBSECTION\subsection
  \renewcommand\subsection[1]{\SUBSECTION*{#1}}
  \let\SUBSUBSECTION\subsubsection
  \renewcommand\subsubsection[1]{\SUBSUBSECTION*{#1}}

  \chapterfont{\large\setstretch{1.0}}
  \sectionfont{\relscale{1.1}}
  \subsectionfont{\relscale{0.9}}

% --------------------------------------------------------------------------- %
%  P A G E   H E A D E R /  F O O T E R
% --------------------------------------------------------------------------- %

  % http://texblog.org/2007/11/07/headerfooter-in-latex-with-fancyhdr
  \pagestyle{fancy}
  \fancyhead{} % CLEAR DEFAULT
  \fancyfoot{} % CLEAR DEFAULT
  \fancyfoot[LO]{\vspace{1mm}%
                 \hspace{-15mm} {\scriptsize\thepage}%
                }
  \fancyfoot[RE]{\vspace{1mm}%
                {\scriptsize\thepage} \hspace{-15mm}%
                }

  \fancypagestyle{black}{%
  \fancyfoot[LO]{\vspace{1mm}%
                 \hspace{-15mm} {\scriptsize\color{white}\thepage}%
                }
  \fancyfoot[RE]{\vspace{1mm}%
                {\scriptsize\color{white}\thepage} \hspace{-15mm}%
                }
  }

  % http://tex.stackexchange.com/questions/114956/
  % -> how-to-insert-footer-in-first-pages-of-chapter 
  \fancypagestyle{plain}{%
  \fancyfoot[LO]{\vspace{1mm} \hspace{-15mm} {\scriptsize\thepage}}
  \fancyfoot[RE]{\vspace{1mm} {\scriptsize\thepage} \hspace{-15mm}}
  }


  \renewcommand{\headrulewidth}{0pt}

% --------------------------------------------------------------------------- %
%  P A G E   C O M M A N D S
% --------------------------------------------------------------------------- %
  \newcommand{\emptypage}{ % SOMEHOW HACKY
   \twocolumn[]\thispagestyle{empty} %
    \onecolumn %
  }
% --------------------------------------------------------------------------- %
  \newcommand\cleartoleft{%
  \clearpage
  \ifthispageodd{\emptypage}{}
  }
% --------------------------------------------------------------------------- %
  \newcommand\cleartoright{%
  \clearpage
  % http://tex.stackexchange.com/questions/6143/
  % -> if-then-else-for-odd-page-even-page
  \ifthispageodd{}{\emptypage}
  }

% --------------------------------------------------------------------------- %
%  Q R
% --------------------------------------------------------------------------- %
   \makeatletter
    \newcommand{\grafikoverlay}[1]{
     \AddToShipoutPicture*{%
      \setlength{\unitlength}{.1\paperwidth}%
       \ifodd\value{page}%
        \put(0.3,12.2){%
         \includegraphics[width=\marginparwidth]
          {#1}}
           \else
            \put(8.1,12.2){%
             \includegraphics[width=\marginparwidth]
              {#1}}
               \fi
   }}\makeatother

   \newcommand\qroverlay[2]{
   \AddThispageHook{
   \newpage
   \grafikoverlay{#1}
   }}

  % VERTICAL SPACE HACK
  % http://tex.stackexchange.com/questions/61627/
  % -> prevent-action-if-top-of-page
  \newcommand\vspacenotonpagetop{%
     \par % make sure we end a paragraph
     \vskip10pt % space above the rule
     \leaders\vrule width \textwidth\vskip0pt % rule thickness is 0pt
     \nointerlineskip % disable interline glue here
     \vskip10pt % space below the rule
  }
   \reversemarginpar
    \newcommand\qrmargin[2]{%
     \vspacenotonpagetop
      \marginpar{
        ~ \\ % NOTHING NEEDED
        \vspace{-15mm}\\
         \includegraphics[width=\marginparwidth]{#1}
          \smallskip\smallskip
    }\vspace{-1.5\baselineskip}
   }

% --------------------------------------------------------------------------- %
%  I N C L U D E   G R A P H I C S
% --------------------------------------------------------------------------- %

% --------------------------------------------------------------------------- %
   \newcommand\pdfpage[3]{%
   \includepdf[pagecommand={\thispagestyle{fancy}},%
               scale=1,pages=#2#3]{#1}
  }
% --------------------------------------------------------------------------- %
   \newcommand\pdfpageplus[4]{%
   \includepdf[pagecommand={\thispagestyle{fancy}#4},%
               scale=1,pages=#2#3]{#1}
  }
% --------------------------------------------------------------------------- %



% --------------------------------------------------------------------------- %
% SOURCE CODE (OVERWRITE FROM 180710_srccode)
% --------------------------------------------------------------------------- %
  \renewcommand{\lstsetBash}{\lstset{language=Bash+,
                                     morekeywords = [2]{write2src,getFile,
                                                        mkqr,getVerbatim},
                                     basicstyle=\fontencoding{T1}%
                                                \linespread{1}%
                                                \fontfamily{grm}%
                                                \selectfont%
                                                \scalefont{.46}}
                      \renewcommand{\emptylinelst}{\vspace{-0.2\baselineskip
                                                     plus  00.1\baselineskip
                                                     minus 0.05\baselineskip}}
                            }
% --------------------------------------------------------------------------- %
  \renewcommand{\lstinputbashcode}[1]{\lstsetCode{1.5} %
                                      \lstsetBash \pagebreak[1]
                                      \needspace{5\baselineskip} %
                                      \lstinputlisting{#1}}


